import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Badge } from '@/components/ui/badge';
import type { VulnerabilityResponse } from '@/api';

interface VulnerabilityModalProps {
  vulnerabilities: VulnerabilityResponse[];
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

function severityVariant(severity: string) {
  switch (severity.toUpperCase()) {
    case 'CRITICAL':
      return 'destructive' as const;
    case 'HIGH':
      return 'destructive' as const;
    default:
      return 'secondary' as const;
  }
}

export function VulnerabilityModal({
  vulnerabilities,
  open,
  onOpenChange,
}: VulnerabilityModalProps) {
  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-[95vw] w-[95vw] h-[85vh] flex flex-col">
        <DialogHeader>
          <DialogTitle>Vulnerabilities ({vulnerabilities.length})</DialogTitle>
        </DialogHeader>

        {vulnerabilities.length === 0 ? (
          <p className="text-muted-foreground text-sm py-4">
            No critical vulnerabilities found.
          </p>
        ) : (
          <div className="flex-1 overflow-y-auto min-h-0">
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>ID</TableHead>
                  <TableHead>Package</TableHead>
                  <TableHead>Severity</TableHead>
                  <TableHead>Installed</TableHead>
                  <TableHead>Fixed</TableHead>
                  <TableHead>Title</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {vulnerabilities.map((v) => (
                  <TableRow key={v.vulnerabilityId}>
                    <TableCell className="font-mono text-xs">
                      {v.vulnerabilityId}
                    </TableCell>
                    <TableCell>{v.pkgName}</TableCell>
                    <TableCell>
                      <Badge variant={severityVariant(v.severity)}>
                        {v.severity}
                      </Badge>
                    </TableCell>
                    <TableCell className="font-mono text-xs">
                      {v.installedVersion}
                    </TableCell>
                    <TableCell className="font-mono text-xs">
                      {v.fixedVersion ?? '—'}
                    </TableCell>
                    <TableCell>{v.title ?? '—'}</TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </div>
        )}
      </DialogContent>
    </Dialog>
  );
}
